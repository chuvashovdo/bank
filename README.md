# Банковское приложение

 Backend система, построенная с использованием функционального программирования на Scala 3, для управления банковскими аккаунтами и аутентификацией пользователей. (пока что реализован только функционал аутентификации и авторизации)

## Технологии

- **ZIO** - функциональная библиотека для описания асинхронного и параллельного программирования и работы с эффектами
- **Tapir** - библиотека для типобезопасного описания HTTP API с автогенерацией Swagger
- **PostgreSQL** - реляционная база данных
- **Quill** - библиотека для типобезопасных SQL-запросов
- **Flyway** - миграция баз данных
- **JWT** - для безопасной аутентификации
- **Docker** - контейнеризация приложения
- **sbt** - система сборки Scala-проектов

## Архитектура

Проект разделен на несколько модулей:

- **01-abstractions** - базовые типы данных и абстракции - один проект для всех абстракций
  - **auth** - абстракции для аутентификации и авторизации
  - **user** - абстракции для управления пользователями
  - **jwt** - абстракции для работы с JWT-токенами
- **02-services**: - отдельный проект для каждого сервиса
  - **auth-service** - сервис аутентификации и авторизации
  - **user-service** - сервис управления пользователями
  - **jwt-service** - сервис работы с JWT-токенами
- **03-app** - точка входа приложения, собирающая все компоненты вместе


Архитектура построена на принципах чистой функциональной архитектуры с использованием ZIO Environment для внедрения зависимостей. Приложение следует подходу порт-адаптер, где бизнес-логика изолирована от внешних влияний. Каждый отдельный сервис имеет разделение на функциональные модули (такие как api, service, repository, config, models, mappers, etc). Всего 5 отдельных проектов в build.sbt - (abstractions, auth-service, user-service, jwt-service, app). Каждый функциональный модуль для каждого проекта имеет свои тесты.

## API-эндпоинты (реализованный функционал) (смотреть в Swagger UI: http://localhost:8080/docs/)

### Публичные эндпоинты (не требуют авторизации)

- `POST /api/auth/register` - регистрация нового пользователя
- `POST /api/auth/login` - авторизация пользователя
- `POST /api/auth/refresh` - обновление JWT-токена по refresh-токену

### Защищенные эндпоинты (требуют JWT-токен)

- `POST /api/auth/logout` - выход из системы
- `GET /api/users/me` - получение информации о текущем пользователе
- `PUT /api/users/me` - обновление данных пользователя
- `POST /api/users/change-password` - изменение пароля пользователя
- `DELETE /api/users/me` - деактивация учетной записи

## Запуск с помощью Docker

### Требования

- Docker
- Docker Compose

### Установка и запуск

Для запуска приложения используйте команду:

```bash
docker compose up -d
```

При первом запуске Docker автоматически:
1. Соберет образ приложения (используя multi-stage build)
2. Запустит PostgreSQL базу данных
3. Запустит банковское приложение после инициализации базы данных

### Доступ к API

После запуска сервисов API будет доступно по адресу:
- Swagger UI: http://localhost:8080/docs/

### Остановка приложения

Для остановки приложения используйте команду:

```bash
docker compose down
```

### Перезапуск с пересборкой после внесения изменений

Если вы внесли изменения в код, выполните:

```bash
docker compose up -d --build
```

## Особенности реализации

- **Функциональное программирование** - использование эффектов ZIO и функциональных паттернов
- **Типобезопасность** - сильная типизация на всех уровнях, от HTTP-запросов до работы с базой данных
- **Миграции БД** - автоматические миграции с помощью Flyway
- **JWT-аутентификация** - полноценная система с refresh-токенами
- **Контейнеризация** - развертывание в Docker с использованием multi-stage сборки
- **API-документация** - автоматическая генерация Swagger
